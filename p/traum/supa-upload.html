<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>üì§ Mehrfach-Bild hochladen mit Anzeige</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body {
      background: #111;
      color: white;
      font-family: sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      height: 100vh;
      margin: 0;
    }
    
    form, #upload-ui {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-top: 20%;
      gap: 1rem;
      padding: 2rem;
      max-width: 400px;
      width: 90vw;
    }
    
    #login-form div {
      display: flex;
      border: 1px dashed white;
      margin-top: -7%;
    }
    
    input, button {
      padding: 0.8rem;
      font-size: 1rem;
      border-radius: 0.5rem;
      border: none;
      width: 100%;
    }
    
    #password {
        background-color: transparent;
        color: white;
        border: none;
    }
    
    .login-btn {
      color: green;
      width: 10%;
      background-color: transparent;
      margin-right: 8%;
    }
    
    #upload-ui {
      display: none;
    }
    
    #selected-files {
      max-height: 100px;
      overflow-y: auto;
      width: 100%;
      background: #111;
      padding: 0.5rem;
      border-radius: 0.5rem;
      font-size: 0.9rem;
      color: #ccc;
      white-space: pre-wrap;
    }
    
    #output {
      margin-top: 1rem;
      font-size: 0.9rem;
      color: #aaa;
      white-space: pre-wrap;
      max-height: 200px;
      overflow-y: auto;
      width: 100%;
      background: #111;
      padding: 1rem;
      border-radius: 0.5rem;
    }
  </style>
</head>
<body>

  <form id="login-form">
    <h2>Login f√ºr Upload</h2>
    <div><input type="password" id="password" placeholder="Passwort" required />
         <button class="login-btn" type="submit">&#x2713;</button></div>
  </form>

  <div id="upload-ui">
    <h2>Upload zur Weltraum-Galerie</h2>
    <input type="file" id="file-input" accept="image/*" multiple />
    <div id="selected-files">Keine Dateien ausgew√§hlt</div>
    <button id="upload-btn">Rakete starten üöÄ (Hochladen)</button>
    <div id="output"></div>
  </div>

  <script>
    const supabase = window.supabase.createClient(
      'https://ziikbioeavgapnjumpju.supabase.co',
      'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InppaWtiaW9lYXZnYXBuanVtcGp1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTMyMTc4MzIsImV4cCI6MjA2ODc5MzgzMn0.IK147XNWr8E8INYsgYZP45vME0CAASM2LBQWKuaJgyw'
    );

    const email = "bea@example.com";
    const loginForm = document.getElementById("login-form");
    const passwordInput = document.getElementById("password");
    const uploadUI = document.getElementById("upload-ui");
    const fileInput = document.getElementById("file-input");
    const uploadBtn = document.getElementById("upload-btn");
    const output = document.getElementById("output");
    const selectedFilesDiv = document.getElementById("selected-files");

    // Login
    loginForm.addEventListener("submit", async (e) => {
      e.preventDefault();
      const password = passwordInput.value;

      const { error } = await supabase.auth.signInWithPassword({
        email,
        password
      });

      if (error) {
        alert("Login fehlgeschlagen: " + error.message);
        return;
      }

      loginForm.style.display = "none";
      uploadUI.style.display = "flex";
    });

    // Dateien anzeigen, wenn Auswahl sich √§ndert
    fileInput.addEventListener("change", () => {
      const files = fileInput.files;
      if (!files.length) {
        selectedFilesDiv.textContent = "Keine Dateien ausgew√§hlt";
        return;
      }
      let names = [];
      for(let i=0; i<files.length; i++) {
        names.push(files[i].name);
      }
      selectedFilesDiv.textContent = "Ausgew√§hlte Dateien:\n" + names.join("\n");
    });

uploadBtn.addEventListener("click", async () => {
  const files = fileInput.files;
  if (!files.length) {
    alert("Bitte mindestens ein Bild ausw√§hlen.");
    return;
  }

  // Nur einmal am Anfang
  output.textContent = `‚¨ÜÔ∏è Starte Upload von ${files.length} Datei(en) üöÄ\n\n`;

  for (let i = 0; i < files.length; i++) {
    const file = files[i];
    const safeName = `${Date.now()}-${Math.random().toString(36).substring(2, 8)}-${file.name}`;
    const path = `${safeName}`;

    const { error } = await supabase
      .storage
      .from("bilder")
      .upload(path, file, {
        cacheControl: '3600',
        upsert: false
      });

    if (error) {
      output.textContent += `‚ùå ${file.name}: Fehler ‚Äì ${error.message} ^‚Å†_‚Å†_‚Å†_‚Å†_‚Å†_‚Å†_‚Å†_‚Å†_‚Å†_‚Å†^\n`;
    } else {
      output.textContent += `‚úÖ ${file.name} Erfolgreich hochgeladen ¬Ø\_(„ÉÑ)_/¬Ø\n`;
    }
  }

  output.textContent += `\nüìå Upload abgeschlossen.`;
});
  </script>
</body>
</html>
