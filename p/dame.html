<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Dame Online</title>
<style>
  body {
    margin: 0;
    background: #333;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
  }
  .board {
    display: grid;
    grid-template-columns: repeat(8, 80px);
    grid-template-rows: repeat(8, 80px);
    border: 5px solid black;
  }
  .cell {
    width: 80px;
    height: 80px;
    display: flex;
    justify-content: center;
    align-items: center;
  }
  .light { background: #ccc; }
  .dark  { background: #555; }

  .piece {
    width: 65px;
    height: 65px;
    border-radius: 50%;
    background-color: rgba(255,255,255,0.2);
    overflow: hidden;
    display: flex;
    justify-content: center;
    align-items: center;
    cursor: pointer;
  }
  .piece img {
    width: 100%;
    height: 100%;
    object-fit: contain;
    transform: rotate(0deg);
  }
  .selected {
    outline: 4px solid yellow;
  }
  .stone {
  width: 80%;
  height: auto;
  max-width: 50px;
  max-height: 50px;
  display: block;
  margin: auto;
  }
  
</style>
</head>
<body>

<div class="board" id="board"></div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-app.js";
  import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyA2foolYwDeoTrfkynuhJu44lb5qDXHFwg",
    authDomain: "auth-adfwc.firebaseapp.com",
    projectId: "auth-adfwc",
    storageBucket: "auth-adfwc.appspot.com",
    messagingSenderId: "221420792742",
    appId: "1:221420792742:web:f75515331cb4c5b4603d"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const docRef = doc(db, "p", "dame");

  const boardElement = document.getElementById("board");

  const IMAGES = {
    1: "../b/weiß.png",
    2: "../b/schwarz.png",
    11: "../b/weiß.png",
    22: "../b/schwarz.png"
  };

  const gameState = {
    board: [],
    currentPlayer: 1,
    selected: null
  };

  function createInitialBoard() {
    const board = [];
    for (let r = 0; r < 8; r++) {
      board[r] = [];
      for (let c = 0; c < 8; c++) {
        if ((r + c) % 2 === 1) {
          if (r < 3) board[r][c] = 2;
          else if (r > 4) board[r][c] = 1;
          else board[r][c] = 0;
        } else {
          board[r][c] = 0;
        }
      }
    }
    return board;
  }

  async function saveGame() {
    await setDoc(docRef, {
      board: JSON.stringify(gameState.board),
      currentPlayer: gameState.currentPlayer
    });
  }

  async function loadGame() {
    const snap = await getDoc(docRef);
    if (snap.exists() && snap.data().board) {
      const data = snap.data();
      gameState.board = JSON.parse(data.board);
      gameState.currentPlayer = data.currentPlayer ?? 1;
    } else {
      gameState.board = createInitialBoard();
      gameState.currentPlayer = 1;
      await saveGame();
    }
    gameState.selected = null;
    renderBoard();
  }

  function renderBoard() {
    boardElement.innerHTML = "";
    for (let r = 0; r < 8; r++) {
      const row = document.createElement("div");
      row.className = "row";
      for (let c = 0; c < 8; c++) {
        const cell = document.createElement("div");
        cell.className = "cell " + (((r + c) % 2 === 0) ? "light" : "dark");
        const stone = gameState.board[r][c];
        if (stone) {
          const img = document.createElement("img");
          img.src = IMAGES[stone];
          img.className = "stone";
          img.style.transform = "rotate(" + (Math.random() * 360) + "deg)";
          cell.appendChild(img);
        }
        cell.onclick = () => handleClick(r, c);
        row.appendChild(cell);
      }
      boardElement.appendChild(row);
    }
  }

  function handleClick(r, c) {
    gameState.board[r][c] = gameState.board[r][c] ? 0 : gameState.currentPlayer;
    gameState.currentPlayer = (gameState.currentPlayer === 1) ? 2 : 1;
    gameState.selected = null;
    renderBoard();
    saveGame();
  }

  loadGame();
</script>

</body>
</html>
