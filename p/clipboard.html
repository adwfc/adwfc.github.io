<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Zwischenablage mit PIN & Firebase</title>
<style>
  body { font-family: Arial, sans-serif; max-width: 600px; margin: 2rem auto; padding: 1rem; }
  label { display: block; margin-top: 1rem; font-weight: bold; }
  textarea, input[type="text"] {
    width: 100%; padding: 0.5rem; margin-top: 0.25rem;
    font-size: 1rem; box-sizing: border-box;
  }
  button {
    margin-top: 1rem; padding: 0.5rem 1rem; font-size: 1rem;
  }
  #status {
    margin-top: 1rem; font-weight: bold; color: green;
  }
  #pinDisplay {
    margin-top: 0.5rem; font-weight: bold; color: blue;
  }
</style>
</head>
<body>

<h1>Zwischenablage mit PIN</h1>

<label for="pinInput">PIN eingeben (zum Laden)</label>
<input type="text" id="pinInput" maxlength="2" pattern="\d{2}" placeholder="z.B. 42" />

<button id="loadBtn">Laden</button>

<label for="textInput">Text</label>
<textarea id="textInput" rows="6" placeholder="Hier Text eingeben..."></textarea>

<button id="saveBtn">Speichern (generiert neue PIN)</button>

<div id="pinDisplay"></div>
<div id="status"></div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-app.js";
  import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyA2foolYwDeoTrfkynuhJu44lb5qDXHFwg",
    authDomain: "auth-adfwc.firebaseapp.com",
    projectId: "auth-adfwc",
    storageBucket: "auth-adfwc.appspot.com",
    messagingSenderId: "221420792742",
    appId: "1:221420792742:web:f75515331cb4c5b4603d"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  const pinInput = document.getElementById("pinInput");
  const textInput = document.getElementById("textInput");
  const saveBtn = document.getElementById("saveBtn");
  const loadBtn = document.getElementById("loadBtn");
  const pinDisplay = document.getElementById("pinDisplay");
  const statusDiv = document.getElementById("status");

  function setStatus(msg, isError = false) {
    statusDiv.textContent = msg;
    statusDiv.style.color = isError ? "red" : "green";
  }

  // 2-stellige PIN zufällig generieren
  function generatePin() {
    return Math.floor(Math.random() * 100).toString().padStart(2, "0");
  }

  // Laden: Text nur anzeigen wenn PIN passt
  async function loadData() {
    const enteredPin = pinInput.value.trim();
    if (!/^\d{2}$/.test(enteredPin)) {
      setStatus("Bitte eine gültige 2-stellige PIN eingeben.", true);
      return;
    }
    try {
      const docRef = doc(db, "p", "clipboard");
      const docSnap = await getDoc(docRef);
      if (docSnap.exists()) {
        const data = docSnap.data();
        if (data.pin === enteredPin) {
          textInput.value = data.content || "";
          setStatus("Text erfolgreich geladen.");
          pinDisplay.textContent = "";
        } else {
          setStatus("Falsche PIN!", true);
          textInput.value = "";
          pinDisplay.textContent = "";
        }
      } else {
        setStatus("Keine Daten gefunden.", true);
        textInput.value = "";
        pinDisplay.textContent = "";
      }
    } catch (e) {
      setStatus("Fehler beim Laden: " + e.message, true);
    }
  }

  // Speichern: Text speichern + neue PIN generieren und speichern + dem User anzeigen
  async function saveData() {
    const newPin = generatePin();
    const content = textInput.value;

    try {
      const docRef = doc(db, "p", "clipboard");
      await setDoc(docRef, { content, pin: newPin });
      setStatus("Text erfolgreich gespeichert.");
      pinDisplay.textContent = "Deine neue PIN: " + newPin + " (bitte merken!)";
      pinInput.value = newPin; // Optional: Eingabefeld aktualisieren
    } catch (e) {
      setStatus("Fehler beim Speichern: " + e.message, true);
    }
  }

  saveBtn.addEventListener("click", saveData);
  loadBtn.addEventListener("click", loadData);
</script>

</body>
</html>
